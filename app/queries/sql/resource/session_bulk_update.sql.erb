UPDATE
  sessions
SET
  schedule = nv.schedule,
  schedule_payload = nv.schedule_payload::integer,
  schedule_at = nv.schedule_at::timestamp,
  updated_at = nv.updated_at::timestamp
FROM
  (
    VALUES
      <% @values.each do |value| %>
        ('<%= value[:id] %>', '<%= value[:schedule] %>', <%= value[:schedule_payload] || 'NULL' %>, <%= value[:schedule_at] ? "'#{value[:schedule_at]}'" : 'NULL' %>, '<%= Time.current.iso8601 %>')
        <%= ',' if value[:id] != @values.last[:id] %>
      <% end %>
  ) AS nv (id, schedule, schedule_payload, schedule_at, updated_at)
WHERE
  sessions.id = nv.id::uuid;
